<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Fee Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            color: #333;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin: 2rem 0;
        }

        header {
            background: #4a6fc7;
            color: white;
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .logo {
            position: absolute;
            top: 1rem;
            left: 1.5rem;
            font-size: 2rem;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .search-section {
            padding: 2rem;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input-group {
            display: flex;
            width: 100%;
            max-width: 500px;
            margin-bottom: 1rem;
        }

        input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 2px solid #ddd;
            border-radius: 50px 0 0 50px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #4a6fc7;
        }

        button {
            background: #4a6fc7;
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 0 50px 50px 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s;
        }

        button:hover {
            background: #3b5ba9;
        }

        .info-text {
            text-align: center;
            color: #6c757d;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .result-section {
            padding: 2rem;
        }

        .student-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-top: 1rem;
        }

        .student-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #f0f0f0;
            margin-bottom: 1.5rem;
        }

        .student-info {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .info-item {
            margin-bottom: 0.8rem;
        }

        .info-label {
            font-weight: 600;
            color: #4a6fc7;
            display: block;
            margin-bottom: 0.2rem;
            font-size: 0.9rem;
        }

        .info-value {
            color: #333;
            font-size: 1.1rem;
        }

        .fee-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            margin-top: 1rem;
        }

        .paid {
            background: #e7f6e9;
            color: #2e7d32;
        }

        .unpaid {
            background: #ffebee;
            color: #c62828;
        }

        .payment-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .payment-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4a6fc7;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .pay-btn {
            background: #2e7d32;
            grid-column: span 2;
            padding: 1rem;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .pay-btn:hover {
            background: #1b5e20;
        }

        .instructions {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 2rem 0;
            border-radius: 4px;
        }

        .instructions h3 {
            color: #ff9800;
            margin-bottom: 0.5rem;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 2rem;
            opacity: 0.8;
        }

        .status-select {
            padding: 0.5rem;
            border-radius: 5px;
            border: 2px solid #ddd;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .student-info,
            .payment-form {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            input, button {
                border-radius: 50px;
                width: 100%;
            }
            
            button {
                margin-top: 1rem;
            }
            
            .pay-btn {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1>Student Fee Portal</h1>
            <p class="subtitle">Check and update fee status</p>
        </header>

        <section class="search-section">
            <div class="input-group">
                <input type="number" id="roll" placeholder="Enter Roll Number">
                <button onclick="check()">
                    <i class="fas fa-search"></i> Check Status
                </button>
            </div>
            <p class="info-text">Please enter your roll number and click check to view fee status</p>
        </section>

        <section class="result-section">
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Important Information</h3>
                <p>Fee must be paid by the 10th of each month. After the due date, a late fee will be applied.</p>
            </div>
            
            <div id="showFee">
                <!-- Student data will be displayed here -->
            </div>
        </section>
    </div>

    <footer>
        <p>Â© 2023 Student Fee Management System | Secure and Reliable</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "3000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
        const supabaseUrl = 'https://ipoviueuhflhqjemgfkw.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlwb3ZpdWV1aGZsaHFqZW1nZmt3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5Mzc5NzEsImV4cCI6MjA2ODUxMzk3MX0.ACNfp4MRa7-r1YYmu04VDltBo5UudrKWWw2NyDPBrk0'
        const client = supabase.createClient(supabaseUrl, supabaseKey)

        const rollNum = document.getElementById('roll')
        addfeedata()
        async function addfeedata() {
            const today = new Date()
            const date = today.getDate();
            const todayFullDate = today.toLocaleDateString();

            const month = today.getMonth();
            const { data } = await client
                .from('Students')
                .select('*')
            // console.log(data);
        
            const { data: checkmonth } = await client
                .from('Fee')
                .select('date')
            if (date > 10) {
                data.forEach(async (element, i) => {
                    if (checkmonth[i].date.slice(3, 5) != month + 1) {
                        const { error } = await client
                            .from('Fee')
                            .insert({ feeRollNum: element.RollNumber, status: 'Unpaid', date: todayFullDate })
                    }
                });
            }
        }

        async function check() {
            if (rollNum.value == ``) {
                toastr.info('Please Enter Roll Number')
                return
            }
            const { data } = await client
                .from('Fee')
                .select('*')
            console.log(data);
            let abc = data.filter(element => element.feeRollNum == rollNum.value)
            // console.log(abc);

            const { data: getdata } = await client
                .from('Students')
                .select('*')
                .eq('RollNumber', rollNum.value)
            console.log(getdata);
            const div = document.getElementById('showFee')
            div.innerHTML = ``
            abc.forEach(async element => {
                if (element.status == 'Unpaid') {
                    div.innerHTML += `
                    <div class="student-card">
                        <img class="student-image" src="${getdata[0].imgPath}" alt="Student Image">
                        <h1>${getdata[0].name}</h1>
                        <div class="student-info">
                            <div class="info-item">
                                <span class="info-label">Father's Name:</span>
                                <span class="info-value">${getdata[0].fatherName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">CNIC:</span>
                                <span class="info-value">${getdata[0].cnic}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Mobile:</span>
                                <span class="info-value">${getdata[0].mobile}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Age:</span>
                                <span class="info-value">${getdata[0].age}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Gender:</span>
                                <span class="info-value">${getdata[0].gender}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Roll Number:</span>
                                <span class="info-value">${getdata[0].RollNumber}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Email:</span>
                                <span class="info-value">${getdata[0].email}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Fee Status:</span>
                            <select class="status-select" id="paid">
                                <option value="Unpaid" ${element.status === 'Unpaid' ? 'selected' : ''}>Unpaid</option>
                                <option value="Paid" ${element.status === 'Paid' ? 'selected' : ''}>Paid</option>
                            </select>
                        </div>
                    </div>`;
                    
                    // Add event listener for the status change
                    document.getElementById('paid').addEventListener('change', async function() {
                        const newStatus = this.value;
                        const { error } = await client
                            .from('Fee')
                            .update({ status: newStatus })
                            .eq('feeRollNum', rollNum.value);
                        if (error) {
                            toastr.error('Error updating fee status');
                            console.error(error);
                        } else {
                            toastr.success('Fee status updated successfully');
                            this.className = newStatus === 'Paid' ? 'status-select paid' : 'status-select unpaid';
                        }
                    });
                } else {
                    div.innerHTML += `
                    <div class="student-card">
                        <img class="student-image" src="${getdata[0].imgPath}" alt="Student Image">
                        <h1>${getdata[0].name}</h1>
                        <div class="student-info">
                            <div class="info-item">
                                <span class="info-label">Father's Name:</span>
                                <span class="info-value">${getdata[0].fatherName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">CNIC:</span>
                                <span class="info-value">${getdata[0].cnic}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Mobile:</span>
                                <span class="info-value">${getdata[0].mobile}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Age:</span>
                                <span class="info-value">${getdata[0].age}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Gender:</span>
                                <span class="info-value">${getdata[0].gender}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Roll Number:</span>
                                <span class="info-value">${getdata[0].RollNumber}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Email:</span>
                                <span class="info-value">${getdata[0].email}</span>
                            </div>
                        </div>
                        <div class="fee-status ${element.status === 'Paid' ? 'paid' : 'unpaid'}">
                            Fee Status: ${element.status}
                        </div>
                    </div>`;
                }
            });

            rollNum.value = ``
        }
    </script>
</body>

</html>